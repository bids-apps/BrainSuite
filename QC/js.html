
<script>
function transpose(a) {
    return Object.keys(a[0]).map(function(c) {
        return a.map(function(r) { return r[c]; });
    });
}

function makecsv(){
/* const rows = [values, reasons];
  let csvContent = "data:text/csv;charset=utf-8,"
   + rows.map(e => e.join("\t")).join("\n");
*/
// var csvContent = values.join("\t");
var reasons = [];
const textsReason = document.querySelectorAll('.exReason');
textsReason.forEach(( textR )=> {
        reasons.push(textR.value)
    });

var subIDs = [];
const textSubID = document.querySelectorAll("input[name='subID']");
textSubID.forEach(( textS )=> {
        subIDs.push(textS.value)
    });

var values = [];
const checkboxes = document.querySelectorAll(`input[name='subID']`);
checkboxes.forEach((checkbox) => {
        values.push(Number(checkbox.checked));
    });


subIDs.unshift('participant_id')
values.unshift('Exclude')
reasons.unshift('Note')
const rows = [subIDs, values, reasons];
rowsT = transpose(rows);
let csvContent = "data:text/csv;charset=utf-8,"
    + rowsT.map(e => e.join("\t")).join("\n");

var encodedUri = encodeURI(csvContent);
var link = document.createElement("a");
link.setAttribute("href", encodedUri);
link.setAttribute("download", "BrainSuiteQC.tsv");
document.body.appendChild(link); // Required for FF

link.click();
}

</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<script>

var endvar = 0;
var jsonPath="brainsuite_state.json";

startTimer();

function startTimer() {
    var foo = setInterval(scanJSON, 10000);
    var n = endvar.toString();
    if (endvar > 0 ) {
        clearInterval(foo);
        console.log('Timer running.');
    }
    else {
  // window .location.reload();
        console.log('Timer not running.');
    }
}

function scanJSON(){
    $.ajax({
        cache: false,
        url: jsonPath,
        dataType: "json",
        success: function(json){
            if (json){
                endvar = json.end;
                statevar = json.process_states;
                console.log("no error");
                var endvarstr = endvar.toString();
                console.log(endvarstr);
                location.reload(true);
            }
            else {
            console.log('error reading json');
            }
            }
        });

}

</script>

<p class="bottom-three">
   <button type="button" style="width:120px;height:60px;font-size : 30px;" id="save" onclick="makecsv();">Save</button>
</p>
